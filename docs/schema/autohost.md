<!-- THIS FILE IS AUTOMATICALLY GENERATED, PLEASE DO NOT EDIT IT MANUALLY -->

# Autohost

These commands should only be usable by clients with the `tachyon.autohost` scope.

## Modes

For now, we're only caring about the slaved mode, as it's a lot more work to implement dedicated mode and might not be necessary until we get a lot more players.

### Dedicated

Communication from players goes directly to the autohost.

#### Pros

-   Lightens the load on the Tachyon server and makes scaling easier
-   Improved latency for players as messages don't need to be sent through a middleman server
-   Players in existing battles can keep playing games there even if the Tachyon server goes down

#### Cons

-   Tachyon server becomes unaware of activity taking place in battles directly, meaning any additional desired functionality such as telemetry or message logging would need to be implemented separately

### Slaved

The Tachyon server acts as a middleman to broker messages between players and the autohost.

#### Pros

-   The Tachyon server effectively has full control over the autohost, making it possible to interject communications which could be useful for various reasons
-   The autohost's implementation has the potential to be much simpler, as the Tachyon server could handle all the pre-game communications and only interface with the autohost when launching the game and putting it in touch with the players

#### Cons

-   The Tachyon server has to do more heavy lifting for custom games, where lots of comms can take place before the game begins
-   Increased Tachyon server load/bandwidth
-   If the Tachyon server goes down, all the existing lobbies (pre-game battles) will also go down

## Matchmaking

Autohosts used for matchmaking should use the slaved mode as no pregame communication between players and the autohost is required. The Tachyon server can dictate the battle's settings and send the final script.txt file straight to the autohost and players.

## Custom Battles

Autohosts used for custom games should use the dedicated mode as lots of pregame communication can take place.

---
- [start](#start)
- [status](#status)
---

## Start

Tell the autohost client to launch the game server (spring-dedicated.exe or spring-headless.exe) with the given script data.

- Endpoint Type: **Request** -> **Response**
- Source: **Server**
- Target: **Autohost**
- Requires Role: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "$id": "autohost.start.request",
    "scopes": [
        "tachyon.lobby"
    ],
    "type": "object",
    "properties": {
        "type": {
            "const": "request",
            "type": "string"
        },
        "messageId": {
            "type": "string"
        },
        "commandId": {
            "const": "autohost/start",
            "type": "string"
        },
        "data": {
            "type": "object",
            "properties": {
                "battleId": {
                    "type": "string"
                },
                "engineVersion": {
                    "pattern": "^[0-9a-zA-Z .+-]+$",
                    "type": "string"
                },
                "gameName": {
                    "type": "string"
                },
                "mapName": {
                    "type": "string"
                },
                "gameArchiveHash": {
                    "pattern": "^[a-fA-F0-9]{128}$",
                    "type": "string"
                },
                "mapArchiveHash": {
                    "pattern": "^[a-fA-F0-9]{128}$",
                    "type": "string"
                },
                "mapOptions": {
                    "type": "object",
                    "patternProperties": {
                        "^(.*)$": {
                            "type": "string"
                        }
                    }
                },
                "gameOptions": {
                    "type": "object",
                    "patternProperties": {
                        "^(.*)$": {
                            "type": "string"
                        }
                    }
                },
                "startDelay": {
                    "type": "integer"
                },
                "startPosType": {
                    "$ref": "startPosType"
                },
                "allyTeams": {
                    "type": "array",
                    "items": {
                        "type": "array",
                        "items": {
                            "type": "integer"
                        }
                    }
                }
            },
            "required": [
                "battleId",
                "engineVersion",
                "gameName",
                "mapName",
                "gameArchiveHash",
                "mapArchiveHash",
                "mapOptions",
                "gameOptions",
                "startDelay",
                "startPosType",
                "allyTeams"
            ]
        }
    },
    "required": [
        "type",
        "messageId",
        "commandId",
        "data"
    ]
}
```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "ipsum",
    "commandId": "autohost/start",
    "data": {
        "battleId": "ipsum",
        "engineVersion": "0",
        "gameName": "ipsum",
        "mapName": "ipsum",
        "gameArchiveHash": "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
        "mapArchiveHash": "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
        "mapOptions": {
            "": "ipsum"
        },
        "gameOptions": {
            "": "ipsum"
        },
        "startDelay": -98000000,
        "startPosType": 0,
        "allyTeams": [
            [
                -98000000
            ]
        ]
    }
}
```
</details>

#### TypeScript Definition
```ts
export type StartPosType = 0 | 1 | 2;

export interface AutohostStartRequest {
    type: "request";
    messageId: string;
    commandId: "autohost/start";
    data: {
        battleId: string;
        engineVersion: string;
        gameName: string;
        mapName: string;
        gameArchiveHash: string;
        mapArchiveHash: string;
        mapOptions: {
            [k: string]: string;
        };
        gameOptions: {
            [k: string]: string;
        };
        startDelay: number;
        startPosType: StartPosType;
        allyTeams: number[][];
    };
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "$id": "autohost.start.response",
    "scopes": [
        "tachyon.lobby"
    ],
    "anyOf": [
        {
            "type": "object",
            "properties": {
                "type": {
                    "const": "response",
                    "type": "string"
                },
                "messageId": {
                    "type": "string"
                },
                "commandId": {
                    "const": "autohost/start",
                    "type": "string"
                },
                "status": {
                    "const": "success",
                    "type": "string"
                }
            },
            "required": [
                "type",
                "messageId",
                "commandId",
                "status"
            ]
        },
        {
            "type": "object",
            "properties": {
                "type": {
                    "const": "response",
                    "type": "string"
                },
                "messageId": {
                    "type": "string"
                },
                "commandId": {
                    "const": "autohost/start",
                    "type": "string"
                },
                "status": {
                    "const": "failed",
                    "type": "string"
                },
                "reason": {
                    "const": "invalid_script",
                    "type": "string"
                }
            },
            "required": [
                "type",
                "messageId",
                "commandId",
                "status",
                "reason"
            ]
        },
        {
            "type": "object",
            "properties": {
                "type": {
                    "const": "response",
                    "type": "string"
                },
                "messageId": {
                    "type": "string"
                },
                "commandId": {
                    "const": "autohost/start",
                    "type": "string"
                },
                "status": {
                    "const": "failed",
                    "type": "string"
                },
                "reason": {
                    "const": "server_already_running",
                    "type": "string"
                }
            },
            "required": [
                "type",
                "messageId",
                "commandId",
                "status",
                "reason"
            ]
        },
        {
            "type": "object",
            "properties": {
                "type": {
                    "const": "response",
                    "type": "string"
                },
                "messageId": {
                    "type": "string"
                },
                "commandId": {
                    "const": "autohost/start",
                    "type": "string"
                },
                "status": {
                    "const": "failed",
                    "type": "string"
                },
                "reason": {
                    "const": "server_failed_to_start",
                    "type": "string"
                }
            },
            "required": [
                "type",
                "messageId",
                "commandId",
                "status",
                "reason"
            ]
        },
        {
            "type": "object",
            "properties": {
                "type": {
                    "const": "response",
                    "type": "string"
                },
                "messageId": {
                    "type": "string"
                },
                "commandId": {
                    "const": "autohost/start",
                    "type": "string"
                },
                "status": {
                    "const": "failed",
                    "type": "string"
                },
                "reason": {
                    "const": "internal_error",
                    "type": "string"
                }
            },
            "required": [
                "type",
                "messageId",
                "commandId",
                "status",
                "reason"
            ]
        },
        {
            "type": "object",
            "properties": {
                "type": {
                    "const": "response",
                    "type": "string"
                },
                "messageId": {
                    "type": "string"
                },
                "commandId": {
                    "const": "autohost/start",
                    "type": "string"
                },
                "status": {
                    "const": "failed",
                    "type": "string"
                },
                "reason": {
                    "const": "unauthorized",
                    "type": "string"
                }
            },
            "required": [
                "type",
                "messageId",
                "commandId",
                "status",
                "reason"
            ]
        },
        {
            "type": "object",
            "properties": {
                "type": {
                    "const": "response",
                    "type": "string"
                },
                "messageId": {
                    "type": "string"
                },
                "commandId": {
                    "const": "autohost/start",
                    "type": "string"
                },
                "status": {
                    "const": "failed",
                    "type": "string"
                },
                "reason": {
                    "const": "invalid_request",
                    "type": "string"
                }
            },
            "required": [
                "type",
                "messageId",
                "commandId",
                "status",
                "reason"
            ]
        },
        {
            "type": "object",
            "properties": {
                "type": {
                    "const": "response",
                    "type": "string"
                },
                "messageId": {
                    "type": "string"
                },
                "commandId": {
                    "const": "autohost/start",
                    "type": "string"
                },
                "status": {
                    "const": "failed",
                    "type": "string"
                },
                "reason": {
                    "const": "command_unimplemented",
                    "type": "string"
                }
            },
            "required": [
                "type",
                "messageId",
                "commandId",
                "status",
                "reason"
            ]
        }
    ]
}
```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "fugiat",
    "commandId": "autohost/start",
    "status": "success"
}
```
</details>

#### TypeScript Definition
```ts
export interface AutohostStartResponse {
    type: "response";
    messageId: string;
    commandId: "autohost/start";
    status: "success";
}
```
Possible Failed Reasons: `invalid_script`, `server_already_running`, `server_failed_to_start`, `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

---

## Status

This event should be sent to the server on connection and whenever any of the status properties change.

- Endpoint Type: **Event**
- Source: **Autohost**
- Target: **Server**
- Requires Role: `tachyon.lobby`

### Event

<details>
<summary>JSONSchema</summary>

```json
{
    "$id": "autohost.status.event",
    "scopes": [
        "tachyon.lobby"
    ],
    "type": "object",
    "properties": {
        "type": {
            "const": "event",
            "type": "string"
        },
        "messageId": {
            "type": "string"
        },
        "commandId": {
            "const": "autohost/status",
            "type": "string"
        },
        "data": {
            "type": "object",
            "properties": {
                "maxBattles": {
                    "type": "integer"
                },
                "currentBattles": {
                    "type": "integer"
                }
            },
            "required": [
                "maxBattles",
                "currentBattles"
            ]
        }
    },
    "required": [
        "type",
        "messageId",
        "commandId",
        "data"
    ]
}
```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "event",
    "messageId": "ea",
    "commandId": "autohost/status",
    "data": {
        "maxBattles": -94000000,
        "currentBattles": -94000000
    }
}
```
</details>

#### TypeScript Definition
```ts
export interface AutohostStatusEvent {
    type: "event";
    messageId: string;
    commandId: "autohost/status";
    data: {
        maxBattles: number;
        currentBattles: number;
    };
}
```
